<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Journal</title>

<style>
:root {
  --bg: #111;
  --fg: #eaeaea;
  --muted: #888;
  --accent: #4f8cff;
  --important: #ffb703;
}

body.light {
  --bg: #fafafa;
  --fg: #111;
  --muted: #666;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--fg);
  font-family: Georgia, serif;
  line-height: 1.45;
}

.container {
  max-width: 700px;
  margin: auto;
  padding: 12px;
}

textarea {
  width: 100%;
  min-height: 120px;
  resize: vertical;
  padding: 10px;
  font-family: inherit;
  font-size: 15px;
  background: transparent;
  color: var(--fg);
  border: 1px solid var(--muted);
}

button {
  background: none;
  border: 1px solid var(--muted);
  color: var(--fg);
  padding: 4px 8px;
  margin-right: 6px;
  cursor: pointer;
}

button.active {
  border-color: var(--accent);
  color: var(--accent);
}

.entry {
  border-left: 2px solid var(--muted);
  padding-left: 8px;
  margin-bottom: 14px;
}

.entry.important {
  border-left-color: var(--important);
}

.time {
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 4px;
}

.actions button {
  font-size: 12px;
}

hr {
  border: none;
  border-top: 1px solid var(--muted);
  margin: 16px 0;
}

.hidden { display: none; }

.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  margin-bottom: 10px;
  font-size: 12px;
}

.day {
  text-align: center;
  padding: 4px;
  cursor: pointer;
  border: 1px solid transparent;
}

.day.has {
  border-color: var(--accent);
}

.day.sel {
  background: var(--accent);
  color: white;
}
</style>
</head>

<body>
<div class="container">

<!-- WRITE -->
<textarea id="input" placeholder="Write…"></textarea>
<div>
  <button id="caps">CAPS</button>
  <button id="imp">IMPORTANT</button>
  <button id="save">SAVE</button>
  <button id="dark">☀︎ / ☾</button>
</div>

<hr>

<!-- CALENDAR -->
<button id="calToggle">CALENDAR ▸</button>
<div id="calendarWrap" class="hidden">
  <div id="calendar" class="calendar"></div>
</div>

<div>
  <button id="filterImp">IMPORTANT ONLY</button>
  <button id="reflect">REFLECTION</button>
</div>

<hr>

<!-- ENTRIES -->
<div id="entries"></div>

</div>

<script>
const $ = id => document.getElementById(id);
let entries = JSON.parse(localStorage.getItem("entries") || "[]");
let caps = false, important = false;
let reflection = false;
let filterImportant = false;
let selectedDate = null;

function saveStore() {
  localStorage.setItem("entries", JSON.stringify(entries));
}

function render() {
  $("entries").innerHTML = "";
  let list = entries.slice().reverse();

  if (filterImportant) list = list.filter(e => e.important);
  if (selectedDate) list = list.filter(e => e.date === selectedDate);

  list.forEach(e => {
    const d = document.createElement("div");
    d.className = "entry" + (e.important ? " important" : "");
    d.innerHTML = `
      <div class="time">${e.time}</div>
      <div>${e.text.replace(/\n/g,"<br>")}</div>
      ${reflection ? `
        <div class="actions">
          <button onclick="copyText(${e.id})">COPY</button>
          <button onclick="del(${e.id})">DELETE</button>
          <button onclick="toggleImp(${e.id})">★</button>
        </div>` : ``}
    `;
    $("entries").appendChild(d);
  });
}

function add() {
  let text = $("input").value.trim();
  if (!text) return;
  if (caps) text = text.toUpperCase();

  const now = new Date();
  entries.push({
    id: Date.now(),
    text,
    important,
    date: now.toISOString().slice(0,10),
    time: now.toLocaleString()
  });
  $("input").value = "";
  important = false;
  $("imp").classList.remove("active");
  saveStore();
  render();
  renderCalendar();
}

function del(id) {
  entries = entries.filter(e => e.id !== id);
  saveStore();
  render();
  renderCalendar();
}

function copyText(id) {
  const e = entries.find(x => x.id === id);
  navigator.clipboard.writeText(e.time + "\n" + e.text);
}

function toggleImp(id) {
  const e = entries.find(x => x.id === id);
  e.important = !e.important;
  saveStore();
  render();
}

$("save").onclick = add;

$("caps").onclick = () => {
  caps = !caps;
  $("caps").classList.toggle("active", caps);
};

$("imp").onclick = () => {
  important = !important;
  $("imp").classList.toggle("active", important);
};

$("reflect").onclick = () => {
  reflection = !reflection;
  $("reflect").classList.toggle("active", reflection);
  render();
};

$("filterImp").onclick = () => {
  filterImportant = !filterImportant;
  $("filterImp").classList.toggle("active", filterImportant);
  render();
};

$("dark").onclick = () => {
  document.body.classList.toggle("light");
};

$("calToggle").onclick = () => {
  $("calendarWrap").classList.toggle("hidden");
  $("calToggle").textContent =
    $("calendarWrap").classList.contains("hidden") ? "CALENDAR ▸" : "CALENDAR ▾";
};

function renderCalendar() {
  const cal = $("calendar");
  cal.innerHTML = "";
  const now = new Date();
  const y = now.getFullYear();
  const m = now.getMonth();

  const firstDay = (new Date(y, m, 1).getDay() + 6) % 7;
  const days = new Date(y, m + 1, 0).getDate();

  for (let i = 0; i < firstDay; i++) cal.appendChild(document.createElement("div"));

  for (let d = 1; d <= days; d++) {
    const date = `${y}-${String(m+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    const div = document.createElement("div");
    div.textContent = d;
    div.className = "day";
    if (entries.some(e => e.date === date)) div.classList.add("has");
    if (date === selectedDate) div.classList.add("sel");
    div.onclick = () => {
      selectedDate = selectedDate === date ? null : date;
      render();
      renderCalendar();
    };
    cal.appendChild(div);
  }
}

render();
renderCalendar();
</script>
</body>
</html>
