<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiet Journal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#fafafa">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    :root { --bg:#fafafa; --text:#222; --muted:#777; --border:#e5e5e5; }
    body.dark { --bg:#121212; --text:#eaeaea; --muted:#aaa; --border:#333; }
    body { font-family:"Georgia","Times New Roman",serif; background:var(--bg); color:var(--text);
    max-width:720px; margin:auto; padding:16px 12px; line-height:1.5; letter-spacing:.005em; font-size:.9rem; }
    header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
    h1 { font-size:1.1rem; font-weight:500; letter-spacing:.02em; }
    button, select { background:none; border:none; color:var(--muted); font-size:.75rem; cursor:pointer; padding:2px 4px; }
    button:hover { color:var(--text); }
    textarea { width:100%; min-height:80px; padding:10px; border:none; border-bottom:1px solid var(--border);
    background:var(--bg); color:var(--text); font-family:inherit; font-size:.9rem; line-height:1.4; resize:none; overflow-y:hidden; }
    textarea:focus { outline:none; }
    textarea[readonly]{background:var(--bg); border-bottom:1px dashed var(--border); color:var(--muted);}
    .day { margin-top:24px; padding:8px 10px; border-left:2px solid var(--border); border-radius:4px;
    background:rgba(0,0,0,.01);}
    .date { font-size:.75rem; color:var(--muted); margin-bottom:6px; font-weight:500; }
    .today { color:var(--text); font-weight:600; }

    /* COMPACT & ALIGNED ENTRIES */
    .entry {
      margin-bottom:8px;
      font-size:.88rem;
      display:grid;
      grid-template-columns: auto 1fr auto; /* time | text | buttons */
      grid-column-gap:6px;
      align-items:start;
    }
    .time {
      font-size:.7rem;
      color:var(--muted);
      white-space:nowrap;
    }
    .entry .text {
      word-break:break-word;
      white-space: pre-wrap;
    }
    .entry .buttons { 
      display:flex; 
      gap:4px;
    }
    .entry button {
      font-size:.65rem;
      margin-left:0;
      padding:1px 3px;
      color:var(--muted);
    }
    .entry button:hover { color:var(--text); }

    .on-this-day { margin-top:16px; padding:8px 10px; border:1px dashed var(--border); border-radius:4px;
    font-size:.78rem; font-style:italic; }
    #drawer { display:none; margin-top:8px; border-top:1px solid var(--border); padding-top:8px; }
    #drawer button, #drawer select { display:block; margin:4px 0; color:var(--text); font-size:.75rem; }
    #cheat { position:fixed;top:4px;left:50%;transform:translateX(-50%);
    background:var(--bg);color:var(--muted);padding:4px 8px;border:1px solid var(--border);
    border-radius:6px;font-size:.7rem;opacity:.9;z-index:9999;display:none;}
    #saveBtn { display:block; margin:4px 0; padding:6px 10px; font-size:.85rem; cursor:pointer; }
  </style>
</head>

<body>
  <div id="cheat">üíæ Ctrl/Cmd+Enter to save ‚Ä¢ ‚ãØ for tools ‚Ä¢ Reflection to browse ‚Ä¢ ‚úèÔ∏è Edit ‚Ä¢ üóëÔ∏è Delete</div>

  <header>
    <h1>Quiet Journal</h1>
    <div>
      <button onclick="toggleDrawer()">‚ãØ</button>
      <button onclick="toggleMode()" id="modeBtn">Reflection</button>
      <button onclick="toggleDarkMode()" id="darkModeToggle">üåô Dark Mode</button> <!-- Dark Mode Toggle Button -->
    </div>
  </header>

  <textarea id="input" placeholder="Write‚Ä¶"></textarea>
  <button id="saveBtn">üíæ Save Entry (Ctrl/Cmd + Enter)</button>

  <div id="drawer">
    <button onclick="toggleDark()">Toggle dark mode</button>
    <select id="yearFilter" onchange="applyYearFilter()"><option value="all">All years</option></select>
    <button onclick="exportTxt()">Export TXT</button>
    <button onclick="exportMd()">Export Markdown</button>
    <button onclick="backup()">Backup</button>
    <button onclick="restore()">Restore</button>
    <button onclick="showReadme()">Read README</button>
  </div>

  <input type="file" id="restoreFile" hidden>
  <div id="journal"></div>

  <script>
    /* DRAWER */
    function toggleDrawer(){drawer.style.display = drawer.style.display==="block" ? "none" : "block";}

    /* DARK MODE */
    if(localStorage.getItem("dark") === "true") {
      document.body.classList.add("dark");
      document.getElementById("darkModeToggle").textContent = "‚òÄÔ∏è Light Mode"; // Default is Dark Mode
    }

    function toggleDarkMode(){
      document.body.classList.toggle("dark");
      const isDark = document.body.classList.contains("dark");
      localStorage.setItem("dark", isDark);
      document.getElementById("darkModeToggle").textContent = isDark ? "‚òÄÔ∏è Light Mode" : "üåô Dark Mode"; // Toggle text
    }

    /* REFLECTION MODE */
    let reflection=false;
    const saveBtn = document.getElementById("saveBtn");
    function toggleMode(){
      reflection=!reflection;
      modeBtn.textContent = reflection ? "Write" : "Reflection";
      input.readOnly = reflection;
      input.style.display = reflection ? "none" : "block";
      saveBtn.style.display = reflection ? "none" : "block";
      load(yearFilter.value);
    }

    /* AUTO-RESIZE */
    function autoResizeTextarea(textarea){
      textarea.style.height="auto";
      textarea.style.height = textarea.scrollHeight + "px";
    }

    /* CORE */
    const input=document.getElementById("input");
    const journalDiv=document.getElementById("journal");
    input.focus();
    input.addEventListener("input", ()=>autoResizeTextarea(input));
    autoResizeTextarea(input);

    document.addEventListener("keydown", e => {
      if (!reflection && (e.ctrlKey || e.metaKey) && e.key === "Enter") addEntry();
    });
    saveBtn.onclick = addEntry;

    function todayKey(d=new Date()){return d.toISOString().split("T")[0];}

    function addEntry(){
      const text=input.value.trim(); if(!text) return;
      const now=new Date(), key=todayKey();
      const data=JSON.parse(localStorage.getItem("journal")||"{}");
      data[key]=data[key]|
